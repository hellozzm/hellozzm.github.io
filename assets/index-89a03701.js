var u=Object.defineProperty;var p=(r,t,e)=>t in r?u(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var n=(r,t,e)=>(p(r,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();class g{constructor(t){n(this,"domMap",{});n(this,"ctx");n(this,"isDrawing",!1);n(this,"lastX",0);n(this,"lastY",0);n(this,"url","ws://localhost:3001/colin");n(this,"ws");var e,o,s,i,l,f;this.domMap={canvas:document.querySelector(t)},this.domMap.canvas.width=((e=this.domMap.canvas)==null?void 0:e.offsetWidth)||0,this.domMap.canvas.height=((o=this.domMap.canvas)==null?void 0:o.offsetHeight)||0,(s=this.domMap.canvas)==null||s.addEventListener("mousedown",h=>{const{offsetX:a,offsetY:c}=h;this.startDrawing(a,c)}),(i=this.domMap.canvas)==null||i.addEventListener("mousemove",h=>{const{offsetX:a,offsetY:c}=h;this.draw(a,c)}),(l=this.domMap.canvas)==null||l.addEventListener("mouseup",()=>{this.stopDrawing()}),this.ctx=(f=this.domMap.canvas)==null?void 0:f.getContext("2d"),this.ctx.strokeStyle="red",this.ctx.lineWidth=5,this.ctx.lineJoin="round",this.ctx.lineCap="round",this.ws=new WebSocket(this.url),this.ws.onopen=()=>{console.log("连接成功")},this.ws.onmessage=async h=>{const{x:a,y:c,type:d}=JSON.parse(await h.data.text());d==="start"?this.startDrawing(a,c,d):d==="drawing"?this.draw(a,c,d):this.stopDrawing(d),console.log(a,c,d)}}startDrawing(t,e,o){this.isDrawing=!0,this.lastX=t,this.lastY=e,o||this.ws.send(JSON.stringify({type:"start",x:t,y:e}))}draw(t,e,o){this.isDrawing&&(this.ctx.beginPath(),this.ctx.moveTo(this.lastX,this.lastY),this.ctx.lineTo(t,e),this.ctx.stroke(),this.lastX=t,this.lastY=e,o||this.ws.send(JSON.stringify({type:"drawing",x:t,y:e})))}stopDrawing(t){this.isDrawing=!1,t||this.ws.send(JSON.stringify({type:"end"}))}}new g("#canvas");
